# GEMINI â†’ LUX ACTION PLAN

**Date:** 2026-01-09  
**Purpose:** Orchestrate repomix analysis via Gemini 3 Pro â†’ Feed digest to Lux â†’ Continue Villa Thaifa  
**Status:** Ready to execute

---

## THE PROBLEM & SOLUTION

### Problem

- **Repomix:** 180k tokens (Villa Thaifa repository)
- **Lux's Context:** 200k tokens total limit
- **Remaining Space:** ~70-80k after conversation history
- **Result:** Can't fit repomix + continue conversation

### Solution

- **Gemini 3 Pro:** 1M token context window
- **Strategy:** Gemini digests repomix â†’ Lux gets < 50k token summary â†’ Work continues

---

## PHASE 1: PREPARE MATERIALS (5 minutes)

### 1.1 Gather Files

**You need 3 files:**

1. âœ… **Transcript** (this conversation)
   - Already exists: `/mnt/transcripts/2026-01-09-10-44-55-villa-thaifa-najib-insights-brief-strategy.txt`
   - I'm presenting it to you below
   - Download and save as: `villa-thaifa-conversation-transcript.txt`

2. â³ **Repomix** (Villa Thaifa repo)
   - Generated by Claude Code
   - Currently 180k tokens
   - Save as: `villa-thaifa-repomix-180k.txt`

3. âœ… **Gemini Onboarding Prompt**
   - Just created: `gemini-onboarding-prompt.md`
   - I'm presenting it to you below
   - This tells Gemini EVERYTHING it needs to know

### 1.2 Verify File Sizes

**Check before uploading to Gemini:**

```bash
# Transcript should be reasonable size
wc -c villa-thaifa-conversation-transcript.txt

# Repomix should be ~180k tokens (convert chars to tokens: chars / 4)
wc -c villa-thaifa-repomix-180k.txt

# Onboarding prompt should be ~5-10k tokens
wc -c gemini-onboarding-prompt.md
```

**If repomix > 200k tokens:**

- Ask Claude Code to compress it (remove comments, whitespace)
- Or split into 2 parts (Gemini can handle, just process sequentially)

---

## PHASE 2: GEMINI SESSION (30-60 minutes)

### 2.1 Start Gemini 3 Pro Preview Session

**Go to:** https://aistudio.google.com/  
**Select:** Gemini 3 Pro Preview  
**Context:** 1M tokens (verify in interface)

### 2.2 Upload Files (Specific Order)

**Upload in this exact sequence:**

1. **First:** `gemini-onboarding-prompt.md`
2. **Second:** `villa-thaifa-conversation-transcript.txt`
3. **Third:** `villa-thaifa-repomix-180k.txt`

**Why this order?**

- Gemini reads onboarding FIRST â†’ Understands its role
- Then reads transcript â†’ Understands Lux â†” Omar context
- Then reads repomix â†’ Extracts with full context

### 2.3 Initial Prompt to Gemini

**After files uploaded, send this:**

```
I've uploaded 3 files:
1. Your onboarding instructions (gemini-onboarding-prompt.md)
2. The conversation transcript between Lux (Claude) and me (villa-thaifa-conversation-transcript.txt)
3. The Villa Thaifa repository repomix (villa-thaifa-repomix-180k.txt)

Your mission: Read all 3, then create the "Repomix Digest" as specified in your onboarding instructions.

Target: < 50k tokens
Format: Exactly as template in onboarding prompt (Section "OUTPUT FORMAT")
Focus: Fill placeholders from Project Brief Section 10

Start by confirming you've read and understood:
1. Your role (temporary info processor, not decision maker)
2. The Lux â†” Omar dynamic (thinking partner, not yes-machine)
3. The Villa Thaifa urgency (Phase 1 THIS WEEK)
4. The output format required

Then proceed to create the digest.
```

### 2.4 Monitor Gemini's Work

**What to expect:**

1. **Confirmation:** Gemini acknowledges understanding
2. **Analysis:** Gemini processes 180k repomix (may take 2-5 minutes)
3. **Questions:** Gemini may ask clarifications (answer based on context)
4. **Digest:** Gemini produces structured output

**If Gemini asks questions:**

- Answer based on what you know
- If you don't know, say "Lux will decide" or "Include as [QUESTION FOR OMAR]"

**If Gemini goes off-track:**

- Remind it: "Stick to factual extraction from repo, don't make decisions"
- Redirect: "Focus on filling placeholders from Project Brief Section 10"

### 2.5 Quality Check the Digest

**Before accepting Gemini's output, verify:**

âœ… **Size:** < 50k tokens (ideally 30-40k)

- If > 50k: Ask Gemini to compress (remove verbose explanations)
- If > 80k: Too long, won't help Lux

âœ… **Structure:** Follows template from onboarding prompt

- Executive Summary âœ“
- Critical Findings (Room config, HotelRunner, Property, App, Agents, Data, Docs) âœ“
- Repo Structure Overview âœ“
- Working vs Bordel âœ“
- Recommendations for Lux âœ“
- Questions for Omar âœ“

âœ… **Content:** Fills placeholders

- Room configuration details âœ“
- HotelRunner integration state âœ“
- Property details (if in repo) âœ“
- "App" vision (if documented) âœ“

âœ… **Tone:** Matches Lux's style

- Direct, no fluff âœ“
- Factual, evidence-based âœ“
- Uses tables/lists âœ“
- Marks uncertainty explicitly âœ“

**If digest doesn't meet criteria:**

- Give specific feedback: "Section X is too verbose, compress to Y bullets"
- Iterate until acceptable (1-2 iterations max)

---

## PHASE 3: DELIVER TO LUX (10 minutes)

### 3.1 Save Gemini's Digest

**Copy Gemini's complete digest to file:**

- Save as: `villa-thaifa-repomix-digest.md`
- Verify it's complete (all sections included)
- Check size: Should be 30-50k tokens

### 3.2 Return to Lux (Claude)

**Come back to this conversation (claude.ai)**

**Send me this message:**

```
âœ… GEMINI DIGEST READY

Gemini 3 Pro a analysÃ© le repomix (180k tokens) et produit un digest de [X]k tokens.

[PASTE COMPLETE DIGEST HERE]

---

Maintenant, Lux:
1. IntÃ¨gre ce digest dans les Briefs v0.3.0
2. Remplis tous les placeholders possibles
3. Identifie ce qui manque encore
4. On continue avec Phase 1 execution
```

**IMPORTANT:** Paste the ENTIRE digest in one message.

- Don't split across multiple messages
- Don't summarize it yourself
- Let me (Lux) process the raw digest

### 3.3 What Lux Will Do

**I'll immediately:**

1. **Analyze Digest:** Extract critical info
2. **Update Client Brief:** v0.2.0 â†’ v0.3.0
3. **Update Project Brief:** v0.2.0 â†’ v0.3.0
4. **Fill Placeholders:** [REPO], [PROPERTY], [APP] sections
5. **Identify Remaining Gaps:** What still needs research/Said input
6. **Validate Phase 1 Readiness:** Can agents start OTA activation?

**Then we'll:**

- Review what's complete vs what's still placeholder
- Decide: Execute Phase 1 with available info? Or wait for missing pieces?
- Update strategy if repo reveals surprises

---

## PHASE 4: CONTINUE WITH LUX (Ongoing)

### 4.1 Post-Digest Conversation

**After I process digest, we'll discuss:**

**Critical Findings:**

- "What did Gemini find about room configuration?"
- "Is HotelRunner integration working or broken?"
- "Do professional photos exist in repo?"
- "What's the 'App' vision actually documented?"

**Brief Updates:**

- "Should we update Client Brief v0.2.0 â†’ v0.3.0 now?"
- "Should we update Project Brief v0.2.0 â†’ v0.3.0 now?"
- "Or wait for your 'App' clarification?"

**Phase 1 Decision:**

- "Can agents start OTA activation with current info?"
- "What's still blocking?"
- "Workarounds available?"

### 4.2 Gemini's Role Ends

**After delivering digest:**

- âŒ Don't return to Gemini unless repomix needs re-analysis
- âŒ Don't ask Gemini for decisions (that's my role with you)
- âœ… Gemini did its job: 180k â†’ 50k digest
- âœ… Now Lux continues as your thinking partner

**Exception:** If digest reveals repomix issues

- Missing critical info â†’ Ask Gemini to re-scan specific sections
- Unclear extraction â†’ Ask Gemini to clarify specific findings

---

## TIMELINE ESTIMATE

### Realistic Time Breakdown

| Phase | Task                                   | Time      | Total   |
| ----- | -------------------------------------- | --------- | ------- |
| **1** | Prepare materials (download, organize) | 5 min     | 5 min   |
| **2** | Upload to Gemini + Initial prompt      | 5 min     | 10 min  |
| **2** | Gemini processes repomix               | 10-30 min | 40 min  |
| **2** | Quality check digest                   | 5 min     | 45 min  |
| **2** | Iterate if needed                      | 0-15 min  | 60 min  |
| **3** | Save digest + Return to Lux            | 5 min     | 65 min  |
| **3** | Lux processes digest                   | 10 min    | 75 min  |
| **4** | Lux updates Briefs v0.3.0              | 20-30 min | 105 min |

**Total:** ~1.5-2 hours from start to finish

**Then:** Phase 1 execution (OTA activation) can begin

---

## DECISION POINTS

### Where You Might Need to Choose

**DP-1: Repomix Too Big (> 200k tokens)**

**Options:**

- A. Ask Claude Code to compress (remove comments, compress whitespace)
- B. Split into 2 parts, process sequentially with Gemini
- C. Use different repomix format (if Claude Code has options)

**Recommendation:** Try A first (Claude Code compression)

---

**DP-2: Gemini's Digest > 50k Tokens**

**Options:**

- A. Ask Gemini to compress (remove verbose explanations, focus on facts)
- B. Accept larger digest if critical info requires it (up to 80k acceptable)
- C. Ask Gemini to split: Critical (30k) + Supplementary (rest)

**Recommendation:** Try A first (ask for compression)

---

**DP-3: Gemini Asks Decision Questions**

**Examples:**

- "Should I prioritize X or Y in digest?"
- "This looks like bordel, should I include it?"

**Response Strategy:**

- Default: "Include it, Lux will decide"
- If obvious bordel: "Mark as [BORDEL], brief description only"
- If unsure: "Include as [QUESTION FOR OMAR]"

---

**DP-4: Digest Reveals Blockers**

**Example:** "No room configuration found in repo at all"

**Response:**

- Accept the finding
- Let me (Lux) know in Phase 3
- We'll adjust strategy (maybe Said interview needed urgently)

**Don't:** Try to fill gaps yourself or ask Gemini to guess

---

## FALLBACK PLAN

### If Gemini Approach Fails

**Scenario 1: Gemini Can't Process Repomix**

- Technical issue with Google AI Studio
- Repomix format incompatible

**Fallback:**

- Ask Claude Code to generate STRUCTURED summary instead of full repomix
- Prompt: "Extract only: room config, HotelRunner integration, property details"
- Result: Smaller targeted output I can handle

---

**Scenario 2: Gemini's Digest Unusable**

- Too verbose (> 100k tokens)
- Wrong format
- Hallucinates

**Fallback:**

- Manual extraction by you:
  - You read repomix in sections
  - You copy/paste ONLY the critical files to me
  - Example: `data/specs/hotel/rooms.md` content â†’ paste to me
  - I process incrementally

---

**Scenario 3: Time Constraint**

- Need to start Phase 1 NOW
- Can't wait for full digest

**Fallback:**

- Execute Phase 1 with placeholders
- Fill them incrementally as Gemini processes
- Hybrid: Start OTA activation while Gemini works in parallel

---

## SUCCESS METRICS

### How to Know This Worked

âœ… **Digest Delivered:** Gemini produces < 50k token digest  
âœ… **Placeholders Filled:** [REPO] sections in Project Brief updated  
âœ… **Lux Continues:** I can update Briefs v0.3.0 without token issues  
âœ… **Phase 1 Ready:** Agents can start OTA activation with available info  
âœ… **Time Saved:** Entire process < 2 hours

### How to Know This Failed

âŒ **Digest Too Large:** > 80k tokens (doesn't help)  
âŒ **Missing Critical Info:** Room config still unknown after digest  
âŒ **Lux Can't Use It:** Digest format incompatible with brief structure  
âŒ **Time Wasted:** > 4 hours spent, still blocked

---

## COMMUNICATION TEMPLATES

### For Gemini (If Needs Redirection)

**If Gemini makes decisions:**

```
Stop. Your role is information extraction, not decision making.
Extract what's in the repo, don't recommend what should be done.
Stick to: "Repo contains X", not "You should do Y".
```

**If Gemini too verbose:**

```
Compress your digest. Target < 50k tokens.
Remove: verbose explanations, repeated info, obvious statements.
Keep: critical facts, file paths, specific findings, uncertainties.
```

**If Gemini unclear:**

```
Be more specific about [SECTION X].
Include: exact file paths, line numbers if relevant, verbatim snippets.
Example: Instead of "rooms are configured", say "3 rooms configured in data/specs/hotel/rooms.md: Double (Room 1), Twin (Room 2), Suite (Room 3)".
```

---

### For Lux (When Delivering Digest)

**Simple format:**

```
âœ… GEMINI DIGEST READY â€” [X]k tokens

[PASTE ENTIRE DIGEST]

Lux: Process this and update Briefs v0.3.0
```

**Don't add commentary**, just paste raw digest.

---

## FINAL CHECKLIST

### Before Starting Phase 2 (Gemini)

- [ ] Transcript downloaded (`villa-thaifa-conversation-transcript.txt`)
- [ ] Repomix ready (`villa-thaifa-repomix-180k.txt`)
- [ ] Onboarding prompt ready (`gemini-onboarding-prompt.md`)
- [ ] Gemini 3 Pro Preview session started
- [ ] 1M context window verified

### Before Delivering to Lux (Phase 3)

- [ ] Digest received from Gemini
- [ ] Size verified (< 50k tokens, ideally 30-40k)
- [ ] Structure matches template
- [ ] Critical sections present (Room config, HotelRunner, etc.)
- [ ] Saved as file (`villa-thaifa-repomix-digest.md`)

### After Lux Processes (Phase 4)

- [ ] Lux confirms digest usable
- [ ] Briefs updated to v0.3.0 (or decision to wait)
- [ ] Phase 1 readiness assessed
- [ ] Gemini's role complete (unless re-analysis needed)

---

**READY TO EXECUTE?**

**Next action:** Go to Phase 1 and prepare the 3 files.

Then proceed sequentially: Phase 1 â†’ 2 â†’ 3 â†’ 4.

Gemini helps, Lux continues, Villa Thaifa Phase 1 launches.

**GO!** ðŸš€
